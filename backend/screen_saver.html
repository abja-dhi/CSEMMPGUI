<!doctype html>
<meta charset="utf-8">
<title>Loading</title>
<style>
  html,body,canvas { margin:0; height:100%; background:#fff; display:block }
</style>
<canvas id="c"></canvas>
<script>
(() => {
  const cnv = document.getElementById('c');
  const ctx = cnv.getContext('2d');
  const img = new Image();
  img.src = 'dhi_logo.png';

  const LOGO_SCALE = 0.10; // smaller than 0.18

  let W=0, H=0, x=0, y=0, iw=0, ih=0;
  let vx = 3, vy = 3;

  // text animation state
  let lastDotT = 0;
  let dotPhase = 0;

  function resize() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    W = Math.floor(innerWidth);
    H = Math.floor(innerHeight);
    cnv.style.width = W + 'px';
    cnv.style.height = H + 'px';
    cnv.width  = Math.floor(W * dpr);
    cnv.height = Math.floor(H * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

    const S = LOGO_SCALE * Math.min(W, H);
    iw = S; ih = S * (img.naturalHeight / img.naturalWidth);
    x = Math.min(Math.max(0, x), Math.max(0, W - iw));
    y = Math.min(Math.max(0, y), Math.max(0, H - ih));
  }

  function drawCenterText(nowMs){
    if (nowMs - lastDotT > 400) { dotPhase = (dotPhase + 1) % 3; lastDotT = nowMs; }
    const dots = '.'.repeat(dotPhase + 1);
    const fs = Math.max(12, Math.round(0.02 * Math.min(W, H)));
    const msg = `Rendering View. Please Wait${dots}`;

    ctx.font = `${fs}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;
    ctx.fillStyle = "#555";
    ctx.textAlign = "left";
    ctx.textBaseline = "alphabetic";

    const m = ctx.measureText(msg);
    const asc = m.actualBoundingBoxAscent || fs * 0.8;
    const desc = m.actualBoundingBoxDescent || fs * 0.2;
    const tx = (W - m.width) / 2;
    const ty = (H + (asc - desc)) / 2;

    ctx.fillText(msg, tx, ty);
  }

  function tick(now){
    x += vx; y += vy;
    if (x <= 0) { x = 0; vx = Math.abs(vx); }
    if (x + iw >= W) { x = W - iw; vx = -Math.abs(vx); }
    if (y <= 0) { y = 0; vy = Math.abs(vy); }
    if (y + ih >= H) { y = H - ih; vy = -Math.abs(vy); }

    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, W, H);

    drawCenterText(now || performance.now());
    ctx.drawImage(img, x, y, iw, ih);

    requestAnimationFrame(tick);
  }

  window.addEventListener('resize', resize);

  img.decode().then(() => {
    resize();
    x = Math.random() * Math.max(1, W - iw);
    y = Math.random() * Math.max(1, H - ih);
    requestAnimationFrame(tick);
  }).catch(() => {
    img.onload = () => { resize(); x = 0; y = 0; requestAnimationFrame(tick); };
  });
})();
</script>

