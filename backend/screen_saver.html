<!doctype html>
<meta charset="utf-8">
<title>Loading</title>
<style>
  html,body,canvas { margin:0; height:100%; background:#fff; display:block }
</style>
<canvas id="c"></canvas>
<script>
(() => {
  const cnv = document.getElementById('c');
  const ctx = cnv.getContext('2d');
  const img = new Image();
  img.src = 'dhi_logo.png';

  const SCALE_MIN = 0.01, SCALE_MAX = 0.18; // fraction of min(W,H)
  const logos = []; // {x,y,vx,vy,iw,ih,s}

  let W=0, H=0;

  // text animation state
  let lastDotT = 0;
  let dotPhase = 0;

  function rand(min, max) { return min + Math.random()*(max-min); }
  function randSign() { return Math.random() < 0.5 ? -1 : 1; }
  function randSpeed() {
    // random pixel/frame speed with min floor
    const mag = rand(1.5, 6.0);
    return mag * randSign();
  }
  function randScale() { return rand(SCALE_MIN, SCALE_MAX); }

  function makeLogo() {
    const s = randScale();
    const Spx = s * Math.min(W, H);
    const iw = Spx;
    const ih = Spx * (img.naturalHeight / img.naturalWidth);
    const x = rand(0, Math.max(1, W - iw));
    const y = rand(0, Math.max(1, H - ih));
    const vx = randSpeed();
    const vy = randSpeed();
    logos.push({ x, y, vx, vy, iw, ih, s });
  }

  function resize() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    W = Math.floor(innerWidth);
    H = Math.floor(innerHeight);
    cnv.style.width = W + 'px';
    cnv.style.height = H + 'px';
    cnv.width  = Math.floor(W * dpr);
    cnv.height = Math.floor(H * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

    // recompute each logo's size from its stored scale
    for (const L of logos) {
      const Spx = L.s * Math.min(W, H);
      L.iw = Spx;
      L.ih = Spx * (img.naturalHeight / img.naturalWidth);
      L.x = Math.min(Math.max(0, L.x), Math.max(0, W - L.iw));
      L.y = Math.min(Math.max(0, L.y), Math.max(0, H - L.ih));
    }
  }

  function drawCenterText(nowMs){
    if (nowMs - lastDotT > 400) { dotPhase = (dotPhase + 1) % 3; lastDotT = nowMs; }
    const dots = '.'.repeat(dotPhase + 1);
    const fs = Math.max(12, Math.round(0.02 * Math.min(W, H)));
    const msg = `Rendering View. Please Wait${dots}`;

    ctx.font = `${fs}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;
    ctx.fillStyle = "#555";
    ctx.textAlign = "left";
    ctx.textBaseline = "alphabetic";

    const m = ctx.measureText(msg);
    const asc = m.actualBoundingBoxAscent || fs * 0.8;
    const desc = m.actualBoundingBoxDescent || fs * 0.2;
    const tx = (W - m.width) / 2;
    const ty = (H + (asc - desc)) / 2;

    ctx.fillText(msg, tx, ty);
  }

  function stepLogo(L) {
    L.x += L.vx;
    L.y += L.vy;

    if (L.x <= 0) { L.x = 0; L.vx = Math.abs(L.vx); }
    if (L.x + L.iw >= W) { L.x = W - L.iw; L.vx = -Math.abs(L.vx); }
    if (L.y <= 0) { L.y = 0; L.vy = Math.abs(L.vy); }
    if (L.y + L.ih >= H) { L.y = H - L.ih; L.vy = -Math.abs(L.vy); }
  }

  function tick(now){
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, W, H);

    drawCenterText(now || performance.now());

    for (const L of logos) {
      stepLogo(L);
      ctx.drawImage(img, L.x, L.y, L.iw, L.ih);
    }
    requestAnimationFrame(tick);
  }

  window.addEventListener('resize', resize);
  window.addEventListener('click', () => { if (img.complete) makeLogo(); });
  window.addEventListener('touchstart', () => { if (img.complete) makeLogo(); }, {passive:true});

  img.decode().then(() => {
    resize();
    makeLogo(); // start with one
    requestAnimationFrame(tick);
  }).catch(() => {
    img.onload = () => { resize(); makeLogo(); requestAnimationFrame(tick); };
  });
})();
</script>
